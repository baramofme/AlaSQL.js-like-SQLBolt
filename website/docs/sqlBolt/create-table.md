# LoveField Lesson 2: 테이블 생성

## 도식, 개체 그리고 관계

데이터베이스의 도식(schema)은 데이터 베이스가 정보를 인지하는 기본 구조다.

정보는 주로 개체(entities)로 표현된다. 개체의 사전적 정의는 `a thing with distinct and independent existence`다. 즉, 독립적으로 식별할 수 있는 것.

즉, 데이터베이스의 도식은 다른 것과 독립적으로 식별 가능한 어떤 것을 인식하는 구조이다.

그리고 이런 도식과 도식은 관계를 맺을 수 있고 이런 관계를 통해 새로운 도식을 만들어낼 수 도 있다.

결과적으로, 스키마는 관계형 테이타베이스의 구조다.

### 도식, 개체의 예

다른 것과 구별하려면 그 개체와 다른 것과의 차이점, 즉 특성(property)이 있어야 한다.

내가 개를 떠올릴 때 함께 떠올리는 개만의 특성은 꼬리 유무, 짖는 소리다.

이를 2차원의 인지 도식으로 표현하자면 다음과 같다.

|꼬리유무|짖는 소리|털 덮음 정도|생김새| 개 이름|
|---|---|---|---|---|
|있음|멍멍|몸 전체 다|개 모양|앙구앙구|

그리고 이 인지 도식은 개라는 추상화된 개념이므로 해당 개념이 적용되는 모든 인스턴스에 적용이 가능하다.  

|꼬리유무|짖는 소리|털 덮음 정도|생김새| 개 이름|
|---|---|---|---|---|
|있음|멍멍|몸 전체 다|개 모양|앙구앙구
|있음|멍멍|몸 전체 다|개 모양|앙구앙구
|있음|멍멍|몸 전체 다|개 모양|띵구
|있음|머웅|몸 전체 다|개 모양|뭉구
|있음|먕먕|털 밀었음|개 모양|먕먕이

그리고 개념은 실제의 손상된 반영이니 정확한 존재를 반영하지 못할 뿐더러 속성만으로는 같은 개체도 생긴다.

엔티티의 인스턴스들을 고유하게 구별하기 위한 속성을 추가해서 구별을 해보자.

|꼬리유무|짖는 소리|털 덮음 정도|생김새| 개 이름|소유권|
|---|---|---|---|---|---|
|있음|멍멍|몸 전체 다|개 모양|앙구앙구|우리 개|
|있음|멍멍|몸 전체 다|개 모양|앙구앙구|우리 개|
|있음|멍멍|몸 전체 다|개 모양|띵구|친구 개|
|있음|머웅|몸 전체 다|개 모양|뭉구|애인 개|
|있음|먕먕|털 밀었음|개 모양|먕먕이|옆집 개|

안 되겠다. 속성만으로는 어떤 임의의 고유 번호를 추가해보자.

|고유번호|꼬리유무|짖는 소리|털 덮음 정도|생김새| 개 이름|소유권|
|---|---|---|---|---|---|---|
|1|있음|멍멍|몸 전체 다|개 모양|앙구앙구|우리 개|
|2|있음|멍멍|몸 전체 다|개 모양|앙구앙구|우리 개|
|3|있음|멍멍|몸 전체 다|개 모양|띵구|친구 개|
|4|있음|머웅|몸 전체 다|개 모양|뭉구|애인 개|
|5|있음|먕먕|털 밀었음|개 모양|먕먕이|옆집 개|

이제, 꼬리유무, 짖는 소리 등의 속성을 가지고 다른 것과 구별할 수 있는 '개'라는 개체(엔티티)를 2차원의 인지도식(스키마)로 표현할 수 있다.

또한 해당 도식에 맞는 여러 가지 것 중 고유번호 혹은 특성들의 조합을 통해서 특정 '인스턴스'를 구별해 낼 수도 있다.

### 관계 예시

이젠 두 인지 도식의 관계를 가지고 무엇을 할 수 있나 보자.

|고유번호|꼬리유무|짖는 소리|털 덮음 정도|생김새| 개 이름|소유권|
|---|---|---|---|---|---|---|
|1|있음|멍멍|몸 전체 다|개 모양|앙구앙구|우리 개|
|2|있음|멍멍|몸 전체 다|개 모양|앙구앙구|우리 개|
|3|있음|멍멍|몸 전체 다|개 모양|띵구|친구 개|
|4|있음|머웅|몸 전체 다|개 모양|뭉구|여 개|
|5|있음|먕먕|털 밀었음|개 모양|먕먕이|옆집 개|

|고유번호|개 소유권|소유자 주거형태|퇴근시간|주 평균 산책횟수|
|---|---|---|---|---|
|1|우리 개|아파트|오후 10시|0회|
|2|친구 개|주택|오후 5시|5회|
|3|애인 개|빌라|오후 7시|3회|

각종 통계 기법을 적용해서 두 자료의 관계(소유자)로 자료를 가공해 새로운 도식을 만든 다음, 아래와 같은 질문들에 대답할 수 있다.

* 소유자 주거형태에 따른 개 모양새(품종)의 분포
* 소유자 퇴근시간에 따른 개 행복도(산책횟수를 매개로 한)
* 소유자 산책회수에 영향을 미치는 주거형태

## 러브필드 스키마 정의

스키마는 관계형 테이터베이스의 구조로, **러브 필드**에서는 이름과 버전 숫자를 가진다. 러브 필드는 영구적인 저장 스토어 위에서 따로 스키마 구조를 생성해서 구동하므로, 이름과 버전 숫자를 조합한 유니크한 정보로 생성된 데이터베이스 인스턴스를 확인한다. 자세한 건 [초기화](./spec.md#초기화) 참조.

데이터 베이스 이름은 반드시 러브필드 [이름 규칙](#이름-규칙)을 따라야 한다. 버전은 반드시 0보다 커야한다. 이 버전은 데이터 베이스가 업그레이드가 필요한지 판단하는데 쓰인다. 개발자는 [데이터베이스 업그레이](./spec.md#데이터베이스-업그레이드)드 메커니즘을 사용해서 데이터 마이그레이션을 지원할 수 있다.

### 데이터 베이스 스키마 빌더

정적 함수로 제공되는 `lf.schema.create()` 를 사용해 스키마를 생성하는 스키마 빌더를 생성할 수 있다. 러브 필드는 소스코드에 자세히 서술해 놓았고 소스 코드는 대응되어 제공되는 소스 코드에 스펙이 기술되어있다. 이것은 날짜가 지난 문서가 생성되는 것을 막기도 한다.

러브필드 API 는 `lf` 네임스페이스 내부에 묶이며 이것은 글로벌 네임스페이스를 오염시키지 않기 위함이다. 모든 스키마 생성은 스키마 빌더를 초기화 함으로써 시작한다.  

### 이름 규칙

```javascript
/^[A-Za-z_][A-Za-z0-9_]*$/.test(name)
```

위 정규식을 위반하는 이름은 예외를 낼 것이다.

### 정의(생성) 예시

새 개체와 관계, 즉 엔티티 스키마를 데이터베이스에 저장하려고 할 때, SQL 에서는 `CREATE TABLE` 구문을 통해 테이블로 생성할 수 있다.

```plsql
테이블 생성 구문/ 추가적인 테이블 제약사항과 기본 값 포함
CREATE TABLE IF NOT EXISTS Asset (
    column 데이터종류 테이블_제약 DEFAULT 기본_값,
    another_column 데이터종류 테이블_제약 DEFAULT 기본_값,
    …
);
```

고유번호, 자산명, 시간을 속성으로 가지는 자산이라는 엔티티를 데이터 베이스 테이블로 생성해보자.

```plsql
CREATE TABLE IF NOT EXIST Asset{
    id STRING PRIMARY KEY,
    asset STRING,
    timestamp INTEGER
}
```

러브필드에서는 다음과 같이 표현할 수 있다.

```javascript
// Begin schema creation.
var schemaBuilder = lf.schema.create('crdb', 1);

schemaBuilder.createTable('Asset').
    addColumn('id', lf.Type.STRING).
    addColumn('asset', lf.Type.STRING).
    addColumn('timestamp', lf.Type.INTEGER).
    addPrimaryKey(['id']);
```



## 연습

<query-pane></query-pane>
 
